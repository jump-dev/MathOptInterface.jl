<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Overview · MathOptInterface</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">MathOptInterface</span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../">Introduction</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Background</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../background/motivation/">Motivation</a></li><li><a class="tocitem" href="../../../background/duality/">Duality</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../manual/standard_form/">Standard form problem</a></li><li><a class="tocitem" href="../../../manual/models/">Models</a></li><li><a class="tocitem" href="../../../manual/variables/">Variables</a></li><li><a class="tocitem" href="../../../manual/constraints/">Constraints</a></li><li><a class="tocitem" href="../../../manual/solutions/">Solutions</a></li><li><a class="tocitem" href="../../../manual/modification/">Problem modification</a></li><li><a class="tocitem" href="../../../manual/example/">A complete example: solving a knapsack problem</a></li><li><a class="tocitem" href="../../../manual/implementing/">Implementing a solver interface</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">API Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../reference/standard_form/">Standard form</a></li><li><a class="tocitem" href="../../../reference/models/">Models</a></li><li><a class="tocitem" href="../../../reference/variables/">Variables</a></li><li><a class="tocitem" href="../../../reference/constraints/">Constraints</a></li><li><a class="tocitem" href="../../../reference/modification/">Modifications</a></li><li><a class="tocitem" href="../../../reference/nonlinear/">Nonlinear programming</a></li><li><a class="tocitem" href="../../../reference/callbacks/">Callbacks</a></li><li><a class="tocitem" href="../../../reference/errors/">Errors</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox" checked/><label class="tocitem" for="menuitem-5"><span class="docs-label">Submodules</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-5-1" type="checkbox"/><label class="tocitem" for="menuitem-5-1"><span class="docs-label">Benchmarks</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Benchmarks/overview/">Overview</a></li><li><a class="tocitem" href="../../Benchmarks/reference/">API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Bridges</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Bridges/overview/">Overview</a></li><li><a class="tocitem" href="../../Bridges/implementation/">Implementation</a></li><li><a class="tocitem" href="../../Bridges/reference/">API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-3" type="checkbox"/><label class="tocitem" for="menuitem-5-3"><span class="docs-label">FileFormats</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../FileFormats/overview/">Overview</a></li><li><a class="tocitem" href="../../FileFormats/reference/">API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-4" type="checkbox"/><label class="tocitem" for="menuitem-5-4"><span class="docs-label">Utilities</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Utilities/overview/">Overview</a></li><li><a class="tocitem" href="../../Utilities/reference/">API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-5" type="checkbox" checked/><label class="tocitem" for="menuitem-5-5"><span class="docs-label">Test</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>Overview</a><ul class="internal"><li><a class="tocitem" href="#How-to-test-a-solver"><span>How to test a solver</span></a></li><li><a class="tocitem" href="#How-to-add-a-test"><span>How to add a test</span></a></li></ul></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Submodules</a></li><li><a class="is-disabled">Test</a></li><li class="is-active"><a href>Overview</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Overview</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jump-dev/MathOptInterface.jl/blob/master/docs/src/submodules/Test/overview.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="test_module"><a class="docs-heading-anchor" href="#test_module">The Test submodule</a><a id="test_module-1"></a><a class="docs-heading-anchor-permalink" href="#test_module" title="Permalink"></a></h1><p>The <code>Test</code> submodule provides tools to help solvers implement unit tests in order to ensure they implement the MathOptInterface API correctly, and to check for solver-correctness.</p><p>We use a centralized repository of tests, so that if we find a bug in one solver, instead of adding a test to that particular repository, we add it here so that all solvers can benefit.</p><h2 id="How-to-test-a-solver"><a class="docs-heading-anchor" href="#How-to-test-a-solver">How to test a solver</a><a id="How-to-test-a-solver-1"></a><a class="docs-heading-anchor-permalink" href="#How-to-test-a-solver" title="Permalink"></a></h2><p>The skeleton below can be used for the wrapper test file of a solver named <code>FooBar</code>. Remove unnecessary tests as appropriate, for example tests for features that the solver does not support (tests are not skipped depending on the value of <code>supports</code>). </p><pre><code class="language-julia"># ============================ /test/MOI_wrapper.jl ============================
module TestFoobar

import FooBar
using MathOptInterface
using Test

const MOI = MathOptInterface

const OPTIMIZER_CONSTRUCTOR = MOI.OptimizerWithAttributes(
    FooBar.Optimizer,
    MOI.Silent() =&gt; true
)
const OPTIMIZER = MOI.instantiate(OPTIMIZER_CONSTRUCTOR)

const BRIDGED = MOI.instantiate(
    OPTIMIZER_CONSTRUCTOR, with_bridge_type = Float64
)
const CONFIG = MOI.Test.TestConfig(
    # Modify tolerances as necessary.
    atol = 1e-6,
    rtol = 1e-6,
    # Set false if dual solutions are not generated
    duals = true,
    # Set false if infeasibility certificates are not generated
    infeas_certificates = true,
    # Use MOI.LOCALLY_SOLVED for local solvers.
    optimal_status = MOI.OPTIMAL,
    # Set true if basis information is available
    basis = false,
)

function test_SolverName()
    @test MOI.get(OPTIMIZER, MOI.SolverName()) == &quot;FooBar&quot;
end

function test_supports_default_copy_to()
    @test MOI.Utilities.supports_default_copy_to(OPTIMIZER, false)
    # Use `@test !...` if names are not supported
    @test MOI.Utilities.supports_default_copy_to(OPTIMIZER, true)
end

function test_unittest()
    # Test all the functions included in dictionary `MOI.Test.unittests`,
    # except functions &quot;number_threads&quot; and &quot;solve_qcp_edge_cases.&quot;
    MOI.Test.unittest(
        BRIDGED,
        CONFIG,
        [&quot;number_threads&quot;, &quot;solve_qcp_edge_cases&quot;]
    )
end

function test_modification()
    MOI.Test.modificationtest(BRIDGED, CONFIG)
end

function test_contlinear()
    MOI.Test.contlineartest(BRIDGED, CONFIG)
end

function test_contquadratictest()
    MOI.Test.contquadratictest(OPTIMIZER, CONFIG)
end

function test_contconic()
    MOI.Test.contlineartest(BRIDGED, CONFIG)
end

function test_intconic()
    MOI.Test.intconictest(BRIDGED, CONFIG)
end

function test_default_objective_test()
    MOI.Test.default_objective_test(OPTIMIZER)
end

function test_default_status_test()
    MOI.Test.default_status_test(OPTIMIZER)
end

function test_nametest()
    MOI.Test.nametest(OPTIMIZER)
end

function test_validtest()
    MOI.Test.validtest(OPTIMIZER)
end

function test_emptytest()
    MOI.Test.emptytest(OPTIMIZER)
end

function test_orderedindicestest()
    MOI.Test.orderedindicestest(OPTIMIZER)
end

function test_scalar_function_constant_not_zero()
    MOI.Test.scalar_function_constant_not_zero(OPTIMIZER)
end

# This function runs all functions in this module starting with `test_`.
function runtests()
    for name in names(@__MODULE__; all = true)
        if startswith(&quot;$(name)&quot;, &quot;test_&quot;)
            @testset &quot;$(name)&quot; begin
                getfield(@__MODULE__, name)()
            end
        end
    end
end

end # module TestFooBar

TestFooBar.runtests()</code></pre><p>Test functions like <code>MOI.Test.unittest</code> and <code>MOI.Test.modificationtest</code> are wrappers around corresponding dictionaries <code>MOI.Test.unittests</code> and <code>MOI.Test.modificationtests</code>. Exclude tests by passing a vector of strings corresponding to the test keys you want to exclude as the third positional argument to the test function.</p><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>Print a list of all keys using <code>println.(keys(MOI.Test.unittests))</code></p></div></div><p>The optimizer <code>BRIDGED</code> constructed with <a href="../../../reference/models/#MathOptInterface.instantiate"><code>instantiate</code></a> automatically bridges constraints that are not supported by <code>OPTIMIZER</code> using the bridges listed in <a href="../../Bridges/reference/#Bridges">Bridges</a>. It is recommended for an implementation of MOI to only support constraints that are natively supported by the solver and let bridges transform the constraint to the appropriate form. For this reason it is expected that tests may not pass if <code>OPTIMIZER</code> is used instead of <code>BRIDGED</code>.</p><p>To test that a specific problem can be solved without bridges, a specific test can be added with <code>OPTIMIZER</code> instead of <code>BRIDGED</code>. For example:</p><pre><code class="language-julia">function test_interval_constraints()
    MOI.Test.linear10test(OPTIMIZER, CONFIG)
end</code></pre><p>checks that <code>OPTIMIZER</code> implements support for <a href="../../../reference/standard_form/#MathOptInterface.ScalarAffineFunction"><code>ScalarAffineFunction</code></a>-in-<a href="../../../reference/standard_form/#MathOptInterface.Interval"><code>Interval</code></a>.</p><h2 id="How-to-add-a-test"><a class="docs-heading-anchor" href="#How-to-add-a-test">How to add a test</a><a id="How-to-add-a-test-1"></a><a class="docs-heading-anchor-permalink" href="#How-to-add-a-test" title="Permalink"></a></h2><p>To give an example, ECOS errored calling <a href="../../../reference/models/#MathOptInterface.optimize!"><code>optimize!</code></a> twice in a row. (See <a href="https://github.com/jump-dev/ECOS.jl/pull/72">ECOS.jl PR #72</a>.)</p><p>We could add a test to ECOS.jl, but that would only stop us from re-introducing the bug to ECOS.jl in the future.</p><p>Instead, if we add a test to <code>MOI.Test</code>, then all solvers will also check that they handle a double optimize call!</p><p>For this test, we care about correctness, rather than performance. therefore, we don&#39;t expect solvers to efficiently decide that they have already solved the problem, only that calling <a href="../../../reference/models/#MathOptInterface.optimize!"><code>optimize!</code></a> twice doesn&#39;t throw an error or give the wrong answer.</p><p>To resolve this issue, follow these steps (tested on Julia v1.5):</p><ol><li>Install the <code>MathOptInterface</code> julia package in <code>dev</code> mode (<a href="https://julialang.github.io/Pkg.jl/v1/managing-packages/#developing-1">ref</a>):<pre><code class="language-julia">julia&gt; ]
(@v1.5) pkg&gt; dev ECOS
(@v1.5) pkg&gt; dev MathOptInterface</code></pre></li><li>From here on, proceed with making the following changes in the <code>~/.julia/dev/MathOptInterface</code> folder (or equivalent <code>dev</code> path on your machine).</li><li>Since the double-optimize error involves solving an optimization problem, add a new test to <a href="https://github.com/jump-dev/MathOptInterface.jl/blob/master/src/Test/UnitTests/solve.jl">src/Test/UnitTests/solve.jl</a>. The test should be something like<pre><code class="language-julia">function solve_twice(model::MOI.ModelLike, config::TestConfig)
    MOI.empty!(model)
    x = MOI.add_variable(model)
    c = MOI.add_constraint(model, MOI.SingleVariable(x), MOI.GreaterThan(1.0))
    MOI.set(model, MOI.ObjectiveSense(), MOI.MIN_SENSE)
    MOI.set(model, MOI.ObjectiveFunction{MOI.SingleVariable}(), MOI.SingleVariable(x))
    if config.solve
        MOI.optimize!(model)
        MOI.optimize!(model)
        MOI.get(model, MOI.TerminationStatus()) == MOI.OPTIMAL
        MOI.get(model, MOI.VariablePrimal(), x) == 1.0
    end
end
unittests[&quot;solve_twice&quot;] = solve_twice</code></pre></li><li>Add a test for the test you just wrote. (We test the tests!) a. Add the name of the test (<code>&quot;solve_twice&quot;</code>) to the end of the array in    <code>MOI.Test.unittest(...)</code> (<a href="https://github.com/jump-dev/MathOptInterface.jl/blob/7543afe4b5151cf36bbd18181c1bb5c83266ae2f/test/Test/unit.jl#L51-L52">link</a>).  b. Add a test for the test towards the end of the &quot;Unit Tests&quot; test set     (<a href="https://github.com/jump-dev/MathOptInterface.jl/blob/7543afe4b5151cf36bbd18181c1bb5c83266ae2f/test/Test/unit.jl#L394">link</a>).     The test should look something like     <code>julia     @testset &quot;solve_twice&quot; begin      MOI.Utilities.set_mock_optimize!(mock,          (mock::MOI.Utilities.MockOptimizer) -&gt; MOI.Utilities.mock_optimize!(              mock,              MOI.OPTIMAL,              (MOI.FEASIBLE_POINT, [1.0]),          ),          (mock::MOI.Utilities.MockOptimizer) -&gt; MOI.Utilities.mock_optimize!(              mock,              MOI.OPTIMAL,              (MOI.FEASIBLE_POINT, [1.0]),              )          )          MOI.Test.solve_twice(mock, config)      end</code>      In the above <code>mock</code> is a <code>MOI.Utilities.MockOptimizer</code> that is defined      tesearlier in the file. In this test, <code>MOI.Utilities.set_mock_optimize!</code> loads      <code>mock</code> with two results. Each says that the      <a href="../../../reference/models/#MathOptInterface.TerminationStatus"><code>TerminationStatus</code></a> is <code>MOI.OPTIMAL</code>, that the      <a href="../../../reference/models/#MathOptInterface.PrimalStatus"><code>PrimalStatus</code></a> is <code>MOI.FEASIBLE_POINT</code>, and that there is one      variable with a <code>MOI.VariableValue</code> or <code>1.0</code></li><li>Run the tests:<pre><code class="language-julia">(@v1.5) pkg&gt; test ECOS</code></pre></li><li>Finally, commit the changes to git from <code>~/.julia/dev/MathOptInterface</code> and submit the PR for review.</li></ol></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../Utilities/reference/">« API Reference</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 24 May 2021 02:39">Monday 24 May 2021</span>. Using Julia version 1.0.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
